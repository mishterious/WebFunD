webpackJsonp([25],{2285:function(e,a,t){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a.default=e,a}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0});var l=t(239),i=s(l),r=t(238),o=s(r),d=t(240),u=s(d),m=t(242),c=s(m),g=t(241),f=s(g),h=t(21),p=s(h),E=t(13),w=s(E),v=t(697),_=t(244),b=t(245),S=t(248),N=t(715),M=n(N),L=t(761),y=t(717),I=t(767),C=s(I),k=t(707),U=s(k),P=t(713),F=s(P),A=t(43),R=s(A),D=t(754),T=n(D),O=t(698),x=n(O),G=t(748),H=t(791),W=s(H),B=t(819),z=s(B),j=t(762),V=s(j),q=t(925),Y=s(q),J=function(a){function t(a){(0,o.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this,a));n.preSubmit=n.preSubmit.bind(n),n.submit=n.submit.bind(n),n.finishSignin=n.finishSignin.bind(n),n.handleLoginIdChange=n.handleLoginIdChange.bind(n),n.handlePasswordChange=n.handlePasswordChange.bind(n);var s="";return new URLSearchParams(n.props.location.search).get("extra")===R.default.SIGNIN_VERIFIED&&new URLSearchParams(n.props.location.search).get("email")&&(s=new URLSearchParams(n.props.location.search).get("email")),n.state={ldapEnabled:"true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_config.EnableLdap,usernameSigninEnabled:"true"===e.window.mm_config.EnableSignInWithUsername,emailSigninEnabled:"true"===e.window.mm_config.EnableSignInWithEmail,samlEnabled:"true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_config.EnableSaml,loginId:s,password:"",showMfa:!1,loading:!1},n}return(0,f.default)(t,a),(0,c.default)(t,null,[{key:"propTypes",get:function(){return{location:p.default.object.isRequired}}}]),(0,c.default)(t,[{key:"componentDidMount",value:function(){document.title=e.window.mm_config.SiteName,C.default.removeGlobalItem("team");var a=e.mm_config.ExperimentalPrimaryTeam,t=F.default.getByName(a);U.default.getCurrentUser()&&t?S.browserHistory.push("/"+t.name+"/channels/"+R.default.DEFAULT_CHANNEL):U.default.getCurrentUser()&&M.redirectUserToDefaultTeam(),new URLSearchParams(this.props.location.search).get("extra")===R.default.SIGNIN_VERIFIED&&new URLSearchParams(this.props.location.search).get("email")&&this.refs.password.focus()}},{key:"preSubmit",value:function(a){var t=this;a.preventDefault();var n=this.props.location,s=n.search.replace(/(extra=password_change)&?/i,"");s!==n.search&&S.browserHistory.replace(""+n.pathname+s+n.hash);var l=this.refs.loginId.value;l!==this.state.loginId&&this.setState({loginId:l});var i=this.refs.password.value;if(i!==this.state.password&&this.setState({password:i}),!(l=l.trim().toLowerCase())){var r="login.no";return this.state.emailSigninEnabled&&(r+="Email"),this.state.usernameSigninEnabled&&(r+="Username"),this.state.ldapEnabled&&(r+="LdapUsername"),void this.setState({serverError:w.default.createElement(v.FormattedMessage,{id:r,values:{ldapUsername:e.window.mm_config.LdapLoginFieldName||x.localizeMessage("login.ldapUsernameLower","AD/LDAP username")}})})}if(!i)return void this.setState({serverError:w.default.createElement(v.FormattedMessage,{id:"login.noPassword",defaultMessage:"Please enter your password"})});(0,y.checkMfa)(l,function(e){e?t.setState({showMfa:!0}):t.submit(l,i,"")},function(e){t.setState({serverError:e.message})})}},{key:"submit",value:function(e,a,t){var n=this;this.setState({serverError:null,loading:!0}),(0,y.webLogin)(e,a,t,function(){var e=new URLSearchParams(n.props.location.search),a=e.get("h")||"",t=e.get("d")||"",s=e.get("id")||"";if(s||a)return void(0,L.addUserToTeamFromInvite)(t,a,s,function(e){n.finishSignin(e)},function(){n.finishSignin()});n.finishSignin()},function(a){"api.user.login.not_verified.app_error"===a.id?S.browserHistory.push("/should_verify_email?&email="+encodeURIComponent(e)):"store.sql_user.get_for_login.app_error"===a.id||"ent.ldap.do_login.user_not_registered.app_error"===a.id?n.setState({showMfa:!1,loading:!1,serverError:w.default.createElement(v.FormattedMessage,{id:"login.userNotFound",defaultMessage:"We couldn't find an account matching your login credentials."})}):"api.user.check_user_password.invalid.app_error"===a.id||"ent.ldap.do_login.invalid_password.app_error"===a.id?n.setState({showMfa:!1,loading:!1,serverError:w.default.createElement(v.FormattedMessage,{id:"login.invalidPassword",defaultMessage:"Your password is incorrect."})}):n.setState({showMfa:!1,serverError:a.message,loading:!1})})}},{key:"finishSignin",value:function(a){var t=e.mm_config.ExperimentalPrimaryTeam,n=F.default.getByName(t),s=new URLSearchParams(this.props.location.search),l=s.get("redirect_to");M.loadCurrentLocale(),l&&l.match(/^\/([^\/]|$)/)?S.browserHistory.push(l):a?S.browserHistory.push("/"+a.name):n?S.browserHistory.push("/"+n.name+"/channels/"+R.default.DEFAULT_CHANNEL):M.redirectUserToDefaultTeam()}},{key:"handleLoginIdChange",value:function(e){this.setState({loginId:e.target.value})}},{key:"handlePasswordChange",value:function(e){this.setState({password:e.target.value})}},{key:"createCustomLogin",value:function(){if("true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_license.CustomBrand&&"true"===e.window.mm_config.EnableCustomBrand){var a=e.window.mm_config.CustomBrandText||"",t=T.formatText(a);return w.default.createElement("div",null,w.default.createElement("img",{src:b.Client4.getBrandImageUrl(0)}),w.default.createElement("p",null,(0,G.messageHtmlToComponent)(t,!1,{mentions:!1})))}return null}},{key:"createLoginPlaceholder",value:function(){var a=this.state.ldapEnabled,t=this.state.usernameSigninEnabled,n=this.state.emailSigninEnabled,s=[];return n&&s.push(x.localizeMessage("login.email","Email")),t&&s.push(x.localizeMessage("login.username","Username")),a&&(e.window.mm_config.LdapLoginFieldName?s.push(e.window.mm_config.LdapLoginFieldName):s.push(x.localizeMessage("login.ldapUsername","AD/LDAP Username"))),s.length>=2?s.slice(0,s.length-1).join(", ")+x.localizeMessage("login.placeholderOr"," or ")+s[s.length-1]:1===s.length?s[0]:""}},{key:"checkSignUpEnabled",value:function(){return"true"===e.window.mm_config.EnableSignUpWithEmail||"true"===e.window.mm_config.EnableSignUpWithGitLab||"true"===e.window.mm_config.EnableSignUpWithOffice365||"true"===e.window.mm_config.EnableSignUpWithGoogle||"true"===e.window.mm_config.EnableLdap||"true"===e.window.mm_config.EnableSaml}},{key:"createLoginOptions",value:function(){var a=new URLSearchParams(this.props.location.search).get("extra"),t="";a&&(a===R.default.SIGNIN_CHANGE?t=w.default.createElement("div",{className:"alert alert-success"},w.default.createElement("i",{className:"fa fa-check"}),w.default.createElement(v.FormattedMessage,{id:"login.changed",defaultMessage:" Sign-in method changed successfully"})):a===R.default.SIGNIN_VERIFIED?t=w.default.createElement("div",{className:"alert alert-success"},w.default.createElement("i",{className:"fa fa-check"}),w.default.createElement(v.FormattedMessage,{id:"login.verified",defaultMessage:" Email Verified"})):a===R.default.SESSION_EXPIRED?t=w.default.createElement("div",{className:"alert alert-warning"},w.default.createElement("i",{className:"fa fa-exclamation-triangle"}),w.default.createElement(v.FormattedMessage,{id:"login.session_expired",defaultMessage:" Your session has expired. Please login again."})):a===R.default.PASSWORD_CHANGE&&(t=w.default.createElement("div",{className:"alert alert-success"},w.default.createElement("i",{className:"fa fa-check"}),w.default.createElement(v.FormattedMessage,{id:"login.passwordChanged",defaultMessage:" Password updated successfully"}))));var n=[],s=this.state.ldapEnabled,l="true"===e.window.mm_config.EnableSignUpWithGitLab,i="true"===e.window.mm_config.EnableSignUpWithGoogle,r="true"===e.window.mm_config.EnableSignUpWithOffice365,o=this.state.samlEnabled,d=this.state.usernameSigninEnabled,u=this.state.emailSigninEnabled;if(u||d||s){var m="";this.state.serverError&&(m=" has-error");var c=w.default.createElement(v.FormattedMessage,{id:"login.signIn",defaultMessage:"Sign in"});this.state.loading&&(c=w.default.createElement("span",null,w.default.createElement("span",{className:"fa fa-refresh icon--rotate"}),w.default.createElement(v.FormattedMessage,{id:"login.signInLoading",defaultMessage:"Signing in..."}))),n.push(w.default.createElement("form",{key:"loginBoxes",onSubmit:this.preSubmit},w.default.createElement("div",{className:"signup__email-container"},w.default.createElement(V.default,{error:this.state.serverError,margin:!0}),w.default.createElement("div",{className:"form-group"+m},w.default.createElement("input",{id:"loginId",className:"form-control",ref:"loginId",name:"loginId",value:this.state.loginId,onChange:this.handleLoginIdChange,placeholder:this.createLoginPlaceholder(),spellCheck:"false",autoCapitalize:"off"})),w.default.createElement("div",{className:"form-group"+m},w.default.createElement("input",{id:"loginPassword",type:"password",className:"form-control",ref:"password",name:"password",value:this.state.password,onChange:this.handlePasswordChange,placeholder:x.localizeMessage("login.password","Password"),spellCheck:"false"})),w.default.createElement("div",{className:"form-group"},w.default.createElement("button",{id:"loginButton",type:"submit",className:"btn btn-primary"},c)))))}return"true"===e.window.mm_config.EnableOpenServer&&this.checkSignUpEnabled()&&n.push(w.default.createElement("div",{className:"form-group",key:"signup"},w.default.createElement("span",null,w.default.createElement(v.FormattedMessage,{id:"login.noAccount",defaultMessage:"Don't have an account? "}),w.default.createElement(_.Link,{id:"signup",to:"/signup_user_complete"+this.props.location.search,className:"signup-team-login"},w.default.createElement(v.FormattedMessage,{id:"login.create",defaultMessage:"Create one now"}))))),(d||u)&&n.push(w.default.createElement("div",{key:"forgotPassword",className:"form-group"},w.default.createElement(_.Link,{to:"/reset_password"},w.default.createElement(v.FormattedMessage,{id:"login.forgot",defaultMessage:"I forgot my password"})))),(u||d||s)&&(l||i||o||r)&&(n.push(w.default.createElement("div",{key:"divider",className:"or__container"},w.default.createElement(v.FormattedMessage,{id:"login.or",defaultMessage:"or"}))),n.push(w.default.createElement("h5",{key:"oauthHeader"},w.default.createElement(v.FormattedMessage,{id:"login.signInWith",defaultMessage:"Sign in with:"})))),l&&n.push(w.default.createElement("a",{className:"btn btn-custom-login gitlab",key:"gitlab",href:b.Client4.getOAuthRoute()+"/gitlab/login"+this.props.location.search},w.default.createElement("span",null,w.default.createElement("span",{className:"icon"}),w.default.createElement("span",null,w.default.createElement(v.FormattedMessage,{id:"login.gitlab",defaultMessage:"GitLab"}))))),i&&n.push(w.default.createElement("a",{className:"btn btn-custom-login google",key:"google",href:b.Client4.getOAuthRoute()+"/google/login"+this.props.location.search},w.default.createElement("span",null,w.default.createElement("span",{className:"icon"}),w.default.createElement("span",null,w.default.createElement(v.FormattedMessage,{id:"login.google",defaultMessage:"Google Apps"}))))),r&&n.push(w.default.createElement("a",{className:"btn btn-custom-login office365",key:"office365",href:b.Client4.getOAuthRoute()+"/office365/login"+this.props.location.search},w.default.createElement("span",null,w.default.createElement("span",{className:"icon"}),w.default.createElement("span",null,w.default.createElement(v.FormattedMessage,{id:"login.office365",defaultMessage:"Office 365"}))))),o&&n.push(w.default.createElement("a",{className:"btn btn-custom-login saml",key:"saml",href:"/login/sso/saml"+this.props.location.search},w.default.createElement("span",null,w.default.createElement("span",{className:"icon fa fa-lock fa--margin-top"}),w.default.createElement("span",null,e.window.mm_config.SamlLoginButtonText)))),0===n.length&&n.push(w.default.createElement(V.default,{error:w.default.createElement(v.FormattedMessage,{id:"login.noMethods",defaultMessage:"No sign-in methods are enabled. Please contact your System Administrator."}),margin:!0})),w.default.createElement("div",null,t,n)}},{key:"render",value:function(){var a=void 0,t=void 0,n=void 0;this.state.showMfa?a=w.default.createElement(Y.default,{loginId:this.state.loginId,password:this.state.password,submit:this.submit}):(a=this.createLoginOptions(),(t=this.createCustomLogin())&&(n="branded"));var s=null;return s="true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_license.CustomBrand&&"true"===e.window.mm_config.EnableCustomBrand?e.window.mm_config.CustomDescriptionText:w.default.createElement(v.FormattedMessage,{id:"web.root.signup_info",defaultMessage:"All team communication in one place, searchable and accessible anywhere"}),w.default.createElement("div",null,w.default.createElement(z.default,null),w.default.createElement("div",{className:"col-sm-12"},w.default.createElement("div",{className:"signup-team__container "+n},w.default.createElement("div",{className:"signup__markdown"},t),w.default.createElement("img",{className:"signup-team-logo",src:W.default}),w.default.createElement("div",{className:"signup__content"},w.default.createElement("h1",null,e.window.mm_config.SiteName),w.default.createElement("h4",{className:"color--light"},s),a))))}}]),t}(w.default.Component);a.default=J}).call(a,t(22))}});
//# sourceMappingURL=25.aa1c47a4a15683f62ac4.js.map