webpackJsonp([20],{2507:function(e,t,a){"use strict";(function(e){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(249),n=s(l),i=a(239),o=s(i),u=a(238),m=s(u),d=a(240),c=s(d),f=a(242),p=s(f),g=a(241),E=s(g),h=a(21),v=s(h),_=a(13),w=s(_),N=a(697),S=a(244),M=a(248),y=a(742),b=a(715),k=r(b),L=a(761),I=a(717),U=a(767),C=s(U),F=a(43),P=s(F),T=a(698),A=r(T),x=a(791),H=s(x),O=a(792),R=s(O),V=a(732),B=s(V),D=function(t){function a(e){(0,m.default)(this,a);var t=(0,c.default)(this,(a.__proto__||(0,o.default)(a)).call(this,e));return t.handleSubmit=t.handleSubmit.bind(t),t.getInviteInfo=t.getInviteInfo.bind(t),t.renderEmailSignup=t.renderEmailSignup.bind(t),t.isUserValid=t.isUserValid.bind(t),t.state=t.getInviteInfo(),t}return(0,E.default)(a,t),(0,p.default)(a,null,[{key:"propTypes",get:function(){return{location:v.default.object}}}]),(0,p.default)(a,[{key:"componentDidMount",value:function(){(0,y.trackEvent)("signup","signup_user_01_welcome")}},{key:"getInviteInfo",value:function(){var e=this,t=new URLSearchParams(this.props.location.search).get("d"),a=new URLSearchParams(this.props.location.search).get("h"),r=new URLSearchParams(this.props.location.search).get("id"),s="",l="",n="",i="",o=!1;if(a&&a.length>0){var u=JSON.parse(t);s=u.email,l=u.display_name,n=u.name,i=u.id}else r&&r.length>0&&(o=!0,(0,L.getInviteInfo)(r,function(t){if(!t)return void e.setState({loading:!1});e.setState({loading:!1,serverError:"",teamDisplayName:t.display_name,teamName:t.name,teamId:t.id})},function(){e.setState({loading:!1,noOpenServerError:!0,serverError:w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.invalid_invite",defaultMessage:"The invite link was invalid.  Please speak with your Administrator to receive an invitation."})})}),t=null,a=null);return{data:t,hash:a,email:s,teamDisplayName:l,teamName:n,teamId:i,inviteId:r,loading:o,serverError:"",noOpenServerError:!1}}},{key:"handleSignupSuccess",value:function(e,t){var a=this;(0,y.trackEvent)("signup","signup_user_02_complete"),(0,I.loginById)(t.id,e.password,"",function(){a.state.hash>0&&C.default.setGlobalItem(a.state.hash,(0,n.default)({usedBefore:!0})),(0,I.loadMe)().then(function(){var e=new URLSearchParams(a.props.location.search).get("redirect_to");e?M.browserHistory.push(e):k.redirectUserToDefaultTeam()})},function(t){"api.user.login.not_verified.app_error"===t.id?M.browserHistory.push("/should_verify_email?email="+encodeURIComponent(e.email)+"&teamname="+encodeURIComponent(a.state.teamName)):a.setState({serverError:t.message,isSubmitting:!1})})}},{key:"isUserValid",value:function(){var e=this.refs.email.value.trim();if(!e)return this.setState({nameError:"",emailError:w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.required"}),passwordError:"",serverError:""}),!1;if(!A.isEmail(e))return this.setState({nameError:"",emailError:w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.validEmail"}),passwordError:"",serverError:""}),!1;var t=this.refs.name.value.trim().toLowerCase();if(!t)return this.setState({nameError:w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.required"}),emailError:"",passwordError:"",serverError:""}),!1;var a=A.isValidUsername(t);if("Cannot use a reserved word as a username."===a)return this.setState({nameError:w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.reserved"}),emailError:"",passwordError:"",serverError:""}),!1;if(a)return this.setState({nameError:w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.usernameLength",values:{min:P.default.MIN_USERNAME_LENGTH,max:P.default.MAX_USERNAME_LENGTH}}),emailError:"",passwordError:"",serverError:""}),!1;var r=this.refs.password.value,s=A.isValidPassword(r,A.getPasswordConfig());return!s||(this.setState({nameError:"",emailError:"",passwordError:s,serverError:""}),!1)}},{key:"handleSubmit",value:function(e){var t=this;if(e.preventDefault(),!this.state.isSubmitting&&this.isUserValid()){this.setState({nameError:"",emailError:"",passwordError:"",serverError:"",isSubmitting:!0});var a={email:this.refs.email.value.trim(),username:this.refs.name.value.trim().toLowerCase(),password:this.refs.password.value,allow_marketing:!0};(0,I.createUserWithInvite)(a,this.state.data,this.state.hash,this.state.inviteId,this.handleSignupSuccess.bind(this,a),function(e){t.setState({serverError:e.message,isSubmitting:!1})})}}},{key:"renderEmailSignup",value:function(){var t=null,a=w.default.createElement("span",{className:"help-block"},w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.emailHelp",defaultMessage:"Valid email required for sign-up"})),r="form-group";this.state.emailError&&(t=w.default.createElement("label",{className:"control-label"},this.state.emailError),a="",r+=" has-error");var s=null,l=w.default.createElement("span",{className:"help-block"},w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.userHelp",defaultMessage:"Username must begin with a letter, and contain between {min} to {max} lowercase characters made up of numbers, letters, and the symbols '.', '-' and '_'",values:{min:P.default.MIN_USERNAME_LENGTH,max:P.default.MAX_USERNAME_LENGTH}})),n="form-group";this.state.nameError&&(s=w.default.createElement("label",{className:"control-label"},this.state.nameError),l="",n+=" has-error");var i=null,o="form-group";this.state.passwordError&&(i=w.default.createElement("label",{className:"control-label"},this.state.passwordError),o+=" has-error");var u=null;this.state.email&&(u=w.default.createElement(N.FormattedHTMLMessage,{id:"signup_user_completed.emailIs",defaultMessage:"Your email address is <strong>{email}</strong>. You'll use this address to sign in to {siteName}.",values:{email:this.state.email,siteName:e.window.mm_config.SiteName}}));var m="margin--extra";return this.state.email&&(m="hidden"),w.default.createElement("form",null,w.default.createElement("div",{className:"inner__content"},w.default.createElement("div",{className:m},w.default.createElement("h5",null,w.default.createElement("strong",null,w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.whatis",defaultMessage:"What's your email address?"}))),w.default.createElement("div",{className:r},w.default.createElement("input",{id:"email",type:"email",ref:"email",className:"form-control",defaultValue:this.state.email,placeholder:"",maxLength:"128",autoFocus:!0,spellCheck:"false",autoCapitalize:"off"}),t,a)),u,w.default.createElement("div",{className:"margin--extra"},w.default.createElement("h5",null,w.default.createElement("strong",null,w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.chooseUser",defaultMessage:"Choose your username"}))),w.default.createElement("div",{className:n},w.default.createElement("input",{id:"name",type:"text",ref:"name",className:"form-control",placeholder:"",maxLength:P.default.MAX_USERNAME_LENGTH,spellCheck:"false",autoCapitalize:"off"}),s,l)),w.default.createElement("div",{className:"margin--extra"},w.default.createElement("h5",null,w.default.createElement("strong",null,w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.choosePwd",defaultMessage:"Choose your password"}))),w.default.createElement("div",{className:o},w.default.createElement("input",{id:"password",type:"password",ref:"password",className:"form-control",placeholder:"",maxLength:"128",spellCheck:"false"}),i)),w.default.createElement("p",{className:"margin--extra"},w.default.createElement("button",{id:"createAccountButton",type:"submit",onClick:this.handleSubmit,className:"btn-primary btn",disabled:this.state.isSubmitting},w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.create",defaultMessage:"Create Account"})))))}},{key:"render",value:function(){var t=null;if(this.state.serverError&&(t=w.default.createElement("div",{className:"form-group has-error"},w.default.createElement("label",{className:"control-label"},this.state.serverError))),this.state.loading)return w.default.createElement(B.default,null);var a=void 0;if("true"!==e.window.mm_config.EnableSignUpWithEmail)return null;a=this.renderEmailSignup();var r=null;!this.state.noOpenServerError&&a&&(r=w.default.createElement("p",null,w.default.createElement(N.FormattedHTMLMessage,{id:"create_team.agreement",defaultMessage:"By proceeding to create your account and use {siteName}, you agree to our <a href='{TermsOfServiceLink}'>Terms of Service</a> and <a href='{PrivacyPolicyLink}'>Privacy Policy</a>. If you do not agree, you cannot use {siteName}.",values:{siteName:e.window.mm_config.SiteName,TermsOfServiceLink:e.window.mm_config.TermsOfServiceLink,PrivacyPolicyLink:e.window.mm_config.PrivacyPolicyLink}}))),this.state.noOpenServerError&&(a=null);var s=null;return s="true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_license.CustomBrand&&"true"===e.window.mm_config.EnableCustomBrand?e.window.mm_config.CustomDescriptionText:w.default.createElement(N.FormattedMessage,{id:"web.root.signup_info",defaultMessage:"All team communication in one place, searchable and accessible anywhere"}),w.default.createElement("div",null,w.default.createElement(R.default,null),w.default.createElement("div",{className:"col-sm-12"},w.default.createElement("div",{className:"signup-team__container padding--less"},w.default.createElement("img",{className:"signup-team-logo",src:H.default}),w.default.createElement("h1",null,e.window.mm_config.SiteName),w.default.createElement("h4",{className:"color--light"},s),w.default.createElement("h4",{className:"color--light"},w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.lets",defaultMessage:"Let's create your account"})),w.default.createElement("span",{className:"color--light"},w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.haveAccount",defaultMessage:"Already have an account?"})," ",w.default.createElement(S.Link,{to:"/login"+this.props.location.search},w.default.createElement(N.FormattedMessage,{id:"signup_user_completed.signIn",defaultMessage:"Click here to sign in."}))),a,t,r)))}}]),a}(w.default.Component);t.default=D}).call(t,a(22))}});
//# sourceMappingURL=20.bef4725b1f2a93bfd73b.js.map